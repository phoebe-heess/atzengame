{"version":3,"file":"gasEstimator.js","sourceRoot":"","sources":["../../../../src/middleware/defaults/gasEstimator.ts"],"names":[],"mappings":";;;AAKA,mDAAsE;AACtE,qDAAuE;AAYhE,MAAM,mBAAmB,GAG9B,CAAC,MAAM,EAAE,EAAE,CACX,KAAK,EAAE,MAAM,EAAE,EAAE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,EAAE,EAAE;IACnD,MAAM,OAAO,GAAG,IAAA,sBAAW,EAAC,MAAM,IAAA,4BAAiB,EAAC,MAAM,CAAC,CAAC,CAAC;IAE7D,MAAM,SAAS,GAAG,MAAM,MAAM,CAAC,wBAAwB,CACrD,OAAO,EACP,OAAO,CAAC,aAAa,EAAE,CAAC,OAAO,EAC/B,SAAS,EAAE,aAAa,CACzB,CAAC;IAEF,MAAM,YAAY,GAAG,IAAA,0CAA8B,EACjD,SAAS,CAAC,YAAY,EACtB,SAAS,EAAE,YAAY,EACvB,UAAU,EAAE,YAAY,CACzB,CAAC;IACF,MAAM,oBAAoB,GAAG,IAAA,0CAA8B,EACzD,SAAS,CAAC,oBAAoB,EAC9B,SAAS,EAAE,oBAAoB,EAC/B,UAAU,EAAE,oBAAoB,CACjC,CAAC;IACF,MAAM,kBAAkB,GAAG,IAAA,0CAA8B,EACvD,SAAS,CAAC,kBAAkB,EAC5B,SAAS,EAAE,kBAAkB,EAC7B,UAAU,EAAE,kBAAkB,CAC/B,CAAC;IAEF,MAAM,CAAC,YAAY,GAAG,YAAY,CAAC;IACnC,MAAM,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;IACnD,MAAM,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;IAE/C,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,EAAE,CAAC;IAC3C,IAAI,UAAU,CAAC,OAAO,KAAK,OAAO,EAAE,CAAC;QACnC,MAAM,6BAA6B,GAAG,IAAA,0CAA8B,EAClE,SAAS,CAAC,6BAA6B,EACtC,SAA6C;YAC5C,EAAE,6BAA6B,EAChC,UAA+C;YAC9C,EAAE,6BAA6B,CAClC,CAAC;QACD,MAAuC,CAAC,6BAA6B;YACpE,6BAA6B,CAAC;IAClC,CAAC;IAED,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AA/CS,QAAA,mBAAmB,uBA+C5B","sourcesContent":["import type {\n  UserOperationFeeOptions,\n  UserOperationOverrides,\n  UserOperationStruct,\n} from \"../../types.js\";\nimport { deepHexlify, resolveProperties } from \"../../utils/index.js\";\nimport { applyUserOpOverrideOrFeeOption } from \"../../utils/userop.js\";\nimport type { MiddlewareClient } from \"../actions.js\";\nimport type { ClientMiddlewareFn } from \"../types.js\";\n\n/**\n * Description default gas estimator middleware for `SmartAccountClient`\n * You can override this middleware with your custom gas estimator middleware\n * by passing it to the client constructor\n *\n * @param client smart account client instance to apply the middleware to\n * @returns middleware execution function used to estimate gas for user operations\n */\nexport const defaultGasEstimator: <C extends MiddlewareClient>(\n  client: C\n) => ClientMiddlewareFn =\n  (client) =>\n  async (struct, { account, overrides, feeOptions }) => {\n    const request = deepHexlify(await resolveProperties(struct));\n\n    const estimates = await client.estimateUserOperationGas(\n      request,\n      account.getEntryPoint().address,\n      overrides?.stateOverride\n    );\n\n    const callGasLimit = applyUserOpOverrideOrFeeOption(\n      estimates.callGasLimit,\n      overrides?.callGasLimit,\n      feeOptions?.callGasLimit\n    );\n    const verificationGasLimit = applyUserOpOverrideOrFeeOption(\n      estimates.verificationGasLimit,\n      overrides?.verificationGasLimit,\n      feeOptions?.verificationGasLimit\n    );\n    const preVerificationGas = applyUserOpOverrideOrFeeOption(\n      estimates.preVerificationGas,\n      overrides?.preVerificationGas,\n      feeOptions?.preVerificationGas\n    );\n\n    struct.callGasLimit = callGasLimit;\n    struct.verificationGasLimit = verificationGasLimit;\n    struct.preVerificationGas = preVerificationGas;\n\n    const entryPoint = account.getEntryPoint();\n    if (entryPoint.version === \"0.7.0\") {\n      const paymasterVerificationGasLimit = applyUserOpOverrideOrFeeOption(\n        estimates.paymasterVerificationGasLimit,\n        (overrides as UserOperationOverrides<\"0.7.0\">)\n          ?.paymasterVerificationGasLimit,\n        (feeOptions as UserOperationFeeOptions<\"0.7.0\">)\n          ?.paymasterVerificationGasLimit\n      );\n      (struct as UserOperationStruct<\"0.7.0\">).paymasterVerificationGasLimit =\n        paymasterVerificationGasLimit;\n    }\n\n    return struct;\n  };\n"]}