{"version":3,"file":"feeEstimator.js","sourceRoot":"","sources":["../../../../src/middleware/defaults/feeEstimator.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,8BAA8B,EAAE,MAAM,sBAAsB,CAAC;AAItE,MAAM,CAAC,MAAM,mBAAmB,GAG9B,CAAC,MAAM,EAAE,EAAE,CACX,KAAK,EAAE,MAAM,EAAE,EAAE,SAAS,EAAE,UAAU,EAAE,EAAE,EAAE;IAU1C,MAAM,OAAO,GAAG,MAAM,MAAM,CAAC,kBAAkB,EAAE,CAAC;IAClD,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,oBAAoB,IAAI,IAAI,EAAE,CAAC;QAClE,MAAM,IAAI,KAAK,CACb,yDAAyD,CAC1D,CAAC;IACJ,CAAC;IAED,IAAI,oBAAoB,GACtB,MAAM,MAAM,CAAC,4BAA4B,EAAE,CAAC;IAE9C,oBAAoB,GAAG,8BAA8B,CACnD,oBAAoB,EACpB,SAAS,EAAE,oBAAoB,EAC/B,UAAU,EAAE,oBAAoB,CACjC,CAAC;IAEF,IAAI,YAAY,GACd,OAAO,CAAC,YAAY;QACpB,OAAO,CAAC,oBAAoB;QAC5B,MAAM,CAAC,oBAAoB,CAAC,CAAC;IAE/B,YAAY,GAAG,8BAA8B,CAC3C,YAAY,EACZ,SAAS,EAAE,YAAY,EACvB,UAAU,EAAE,YAAY,CACzB,CAAC;IAEF,MAAM,CAAC,YAAY,GAAG,YAAY,CAAC;IACnC,MAAM,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;IACnD,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC","sourcesContent":["import type { BigNumberish } from \"../../types\";\nimport { applyUserOpOverrideOrFeeOption } from \"../../utils/index.js\";\nimport type { MiddlewareClient } from \"../actions\";\nimport type { ClientMiddlewareFn } from \"../types\";\n\nexport const defaultFeeEstimator: <C extends MiddlewareClient>(\n  client: C\n) => ClientMiddlewareFn =\n  (client) =>\n  async (struct, { overrides, feeOptions }) => {\n    // maxFeePerGas must be at least the sum of maxPriorityFeePerGas and baseFee\n    // so we need to accommodate for the fee option applied maxPriorityFeePerGas for the maxFeePerGas\n    //\n    // Note that if maxFeePerGas is not at least the sum of maxPriorityFeePerGas and required baseFee\n    // after applying the fee options, then the transaction will fail\n    //\n    // Refer to https://docs.alchemy.com/docs/maxpriorityfeepergas-vs-maxfeepergas\n    // for more information about maxFeePerGas and maxPriorityFeePerGas\n\n    const feeData = await client.estimateFeesPerGas();\n    if (!feeData.maxFeePerGas || feeData.maxPriorityFeePerGas == null) {\n      throw new Error(\n        \"feeData is missing maxFeePerGas or maxPriorityFeePerGas\"\n      );\n    }\n\n    let maxPriorityFeePerGas: BigNumberish =\n      await client.estimateMaxPriorityFeePerGas();\n\n    maxPriorityFeePerGas = applyUserOpOverrideOrFeeOption(\n      maxPriorityFeePerGas,\n      overrides?.maxPriorityFeePerGas,\n      feeOptions?.maxPriorityFeePerGas\n    );\n\n    let maxFeePerGas: BigNumberish =\n      feeData.maxFeePerGas -\n      feeData.maxPriorityFeePerGas +\n      BigInt(maxPriorityFeePerGas);\n\n    maxFeePerGas = applyUserOpOverrideOrFeeOption(\n      maxFeePerGas,\n      overrides?.maxFeePerGas,\n      feeOptions?.maxFeePerGas\n    );\n\n    struct.maxFeePerGas = maxFeePerGas;\n    struct.maxPriorityFeePerGas = maxPriorityFeePerGas;\n    return struct;\n  };\n"]}