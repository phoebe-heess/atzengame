{
  "version": 3,
  "sources": ["../../@biconomy/paymaster/dist/esm/index.js", "../../@biconomy/paymaster/dist/esm/BiconomyPaymaster.js", "../../@biconomy/paymaster/dist/esm/utils/Types.js", "../../@biconomy/paymaster/dist/esm/utils/Constants.js", "../../@biconomy/paymaster/dist/esm/utils/Helpers.js", "../../@biconomy/paymaster/dist/esm/interfaces/IPaymaster.js", "../../@biconomy/paymaster/dist/esm/interfaces/IHybridPaymaster.js"],
  "sourcesContent": ["\"use strict\";import{BiconomyPaymaster as r}from\"./BiconomyPaymaster.js\";export*from\"./interfaces/IPaymaster.js\";export*from\"./interfaces/IHybridPaymaster.js\";export*from\"./utils/Types.js\";export*from\"./BiconomyPaymaster.js\";export const Paymaster=r,createPaymaster=Paymaster.create;\n", "\"use strict\";import{encodeFunctionData as G,parseAbi as L}from\"viem\";import{PaymasterMode as f}from\"./utils/Types.js\";import{MAX_UINT256 as w,ERC20_ABI as k,ADDRESS_ZERO as x}from\"./utils/Constants.js\";import{sendRequest as A,HttpMethod as y,Logger as p}from\"@biconomy/common\";import{getTimestampInSeconds as g}from\"./utils/Helpers.js\";const I={paymasterUrl:\"\",strictMode:!1};export class BiconomyPaymaster{constructor(t){Object.defineProperty(this,\"paymasterConfig\",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e={...I,...t};this.paymasterConfig=e}async prepareUserOperation(t){const e={...t};try{const n=[\"nonce\",\"maxFeePerGas\",\"maxPriorityFeePerGas\"];for(const r of n)e[r]&&e[r]!==\"0x\"&&(e[r]=\"0x\"+BigInt(t[r]).toString(16));const i=[\"callGasLimit\",\"verificationGasLimit\",\"preVerificationGas\"];for(const r of i)e[r]&&e[r]!==\"0x\"&&(e[r]=BigInt(t[r]).toString())}catch(n){throw`Failed to transform user operation: ${n}`}return e.signature=t.signature||\"0x\",e.paymasterAndData=t.paymasterAndData||\"0x\",e}async buildTokenApprovalTransaction(t){const e=t.feeQuote.tokenAddress,n=t.spender;let i=BigInt(0);t.maxApproval&&t.maxApproval==!0?i=BigInt(w):i=BigInt(Math.ceil(t.feeQuote.maxGasFee*Math.pow(10,t.feeQuote.decimal)));try{const r=L(k),s=G({abi:r,functionName:\"approve\",args:[n,i]});return{to:e,value:\"0x00\",data:s}}catch{throw new Error(\"Failed to encode function data\")}}async getPaymasterFeeQuotesOrData(t,e){t=await this.prepareUserOperation(t);let n=null,i=null;const r=e.calculateGasLimits??!0;let s=null,c=[],l={name:\"BICONOMY\",version:\"2.0.0\"},a=null;e.mode&&(n=e.mode),e.expiryDuration&&(i=e.expiryDuration),s=e?.preferredToken?e?.preferredToken:s,c=e?.tokenList?.length!==0?e?.tokenList:c,a=e?.webhookData??a,l=e?.smartAccountInfo??l;try{const o=await A({url:`${this.paymasterConfig.paymasterUrl}`,method:y.Post,body:{method:\"pm_getFeeQuoteOrData\",params:[t,{...n!==null&&{mode:n},calculateGasLimits:r,...i!==null&&{expiryDuration:i},tokenInfo:{tokenList:c,...s!==null&&{preferredToken:s}},sponsorshipInfo:{...a!==null&&{webhookData:a},smartAccountInfo:l}}],id:g(),jsonrpc:\"2.0\"}},\"Paymaster\");if(o&&o.result)if(o.result.mode==f.ERC20){const d=o.result.feeQuotes,m=o.result.paymasterAddress;return{feeQuotes:d,tokenPaymasterAddress:m}}else if(o.result.mode==f.SPONSORED){const d=o.result.paymasterAndData,m=o.result.preVerificationGas,u=o.result.verificationGasLimit,h=o.result.callGasLimit;return{paymasterAndData:d,preVerificationGas:m,verificationGasLimit:u,callGasLimit:h}}else throw{code:417,message:\"Expectation Failed: Invalid mode in Paymaster service response\"}}catch(o){if(p.error(\"Failed to fetch Fee Quotes or Paymaster data - reason: \",JSON.stringify(o)),!this.paymasterConfig.strictMode&&e.mode==f.SPONSORED&&(o?.message.includes(\"Smart contract data not found\")||o?.message.includes(\"No policies were set\")))return p.warn(`Strict mode is ${this.paymasterConfig.strictMode}. sending paymasterAndData 0x`),{paymasterAndData:\"0x\",preVerificationGas:t.preVerificationGas,verificationGasLimit:t.verificationGasLimit,callGasLimit:t.callGasLimit};throw o}throw new Error(\"Failed to fetch feeQuote or paymaster data\")}async getPaymasterAndData(t,e){if(t=await this.prepareUserOperation(t),e?.mode===void 0)throw new Error(\"mode is required in paymasterServiceData\");const n=e.mode,i=e.calculateGasLimits??!0;let r=null,s=null,c={name:\"BICONOMY\",version:\"2.0.0\"},l=null;if(n===f.ERC20){if(!e?.feeTokenAddress&&e?.feeTokenAddress===x)throw new Error(\"feeTokenAddress is required and should be non-zero\");r={feeTokenAddress:e.feeTokenAddress}}l=e?.webhookData??l,c=e?.smartAccountInfo??c,s=e?.expiryDuration??s;try{const a=await A({url:`${this.paymasterConfig.paymasterUrl}`,method:y.Post,body:{method:\"pm_sponsorUserOperation\",params:[t,{mode:n,calculateGasLimits:i,...s!==null&&{expiryDuration:s},...r!==null&&{tokenInfo:r},sponsorshipInfo:{...l!==null&&{webhookData:l},smartAccountInfo:c}}],id:g(),jsonrpc:\"2.0\"}},\"Paymaster\");if(a&&a.result){const o=a.result.paymasterAndData,d=a.result.preVerificationGas,m=a.result.verificationGasLimit,u=a.result.callGasLimit;return{paymasterAndData:o,preVerificationGas:d,verificationGasLimit:m,callGasLimit:u}}}catch(a){throw p.error(\"Error in generating paymasterAndData - reason: \",JSON.stringify(a)),a}throw new Error(\"Error in generating paymasterAndData\")}async getDummyPaymasterAndData(t,e){return\"0x\"}static async create(t){return new BiconomyPaymaster(t)}}\n", "\"use strict\";export var PaymasterMode;(function(E){E.ERC20=\"ERC20\",E.SPONSORED=\"SPONSORED\"})(PaymasterMode||(PaymasterMode={}));\n", "\"use strict\";export const MAX_UINT256=\"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\",ENTRYPOINT_ADDRESS=\"0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789\",ADDRESS_ZERO=\"0x0000000000000000000000000000000000000000\",ERC20_ABI=[\"function transfer(address to, uint256 value) external returns (bool)\",\"function transferFrom(address from, address to, uint256 value) external returns (bool)\",\"function approve(address spender, uint256 value) external returns (bool)\",\"function allowance(address owner, address spender) external view returns (uint256)\",\"function balanceOf(address owner) external view returns (uint256)\"];\n", "\"use strict\";export const getTimestampInSeconds=()=>Math.floor(Date.now()/1e3);\n", "\"use strict\";export{};\n", "\"use strict\";export{};\n"],
  "mappings": "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",
  "names": ["t"]
}
